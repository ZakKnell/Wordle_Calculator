name: Build Executables

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Qt
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.5.3'
        arch: 'x64'
    
    - name: Configure CMake
      run: cmake -B ${{github.workspace}}/build -DCMAKE_PREFIX_PATH=${{env.QTDIR}}
    
    - name: Build
      run: cmake --build ${{github.workspace}}/build --config Release
    
    - name: Deploy Qt
      run: |
        ${{env.QTDIR}}/bin/windeployqt.exe ${{github.workspace}}/build/Release/Wordle_Calculator.exe
    
    - name: Upload Windows Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Wordle_Calculator_Windows
        path: ${{github.workspace}}/build/Release/

  build-macos:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install Qt using Homebrew
      run: |
        brew install qt@6
        echo "QTDIR=/opt/homebrew/opt/qt@6" >> $GITHUB_ENV
        echo "CMAKE_PREFIX_PATH=/opt/homebrew/opt/qt@6" >> $GITHUB_ENV
    
    - name: Configure CMake
      run: cmake -B ${{github.workspace}}/build -DCMAKE_PREFIX_PATH=${{env.CMAKE_PREFIX_PATH}}
    
    - name: Build
      run: cmake --build ${{github.workspace}}/build --config Release
    
    - name: Debug - List build directory
      run: |
        echo "Build directory contents:"
        ls -la ${{github.workspace}}/build/
        echo "Looking for app bundle..."
        find ${{github.workspace}}/build/ -name "*.app" -type d
    
    - name: Deploy Qt (if app exists)
      run: |
        if [ -d "${{github.workspace}}/build/Wordle_Calculator.app" ]; then
          ${{env.QTDIR}}/bin/macdeployqt ${{github.workspace}}/build/Wordle_Calculator.app -dmg
          echo "DMG created successfully"
        else
          echo "App bundle not found, skipping DMG creation"
          exit 0
        fi
    
    - name: Upload macOS Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Wordle_Calculator_macOS
        path: ${{github.workspace}}/build/Wordle_Calculator.dmg
        if-no-files-found: ignore 